{% extends 'base.html' %}

{% block content %}

<div id="bannerCarousel" class="carousel slide mb-5 shadow rounded overflow-hidden" data-bs-ride="carousel">
    
    <div class="carousel-indicators">
        <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="0" class="active"></button>
        <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="1"></button>
        <button type="button" data-bs-target="#bannerCarousel" data-bs-slide-to="2"></button>
    </div>

    <div class="carousel-inner">
        <div class="carousel-item active" data-bs-interval="4000">
            <img src="https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?q=80&w=1200&h=400&fit=crop" class="d-block w-100" alt="Black Friday" style="object-fit: cover; height: 350px;">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                <h2 class="fw-bold">BLACK FRIDAY</h2>
                <p class="fs-5">Descontos de até 70% em toda a loja.</p>
            </div>
        </div>
        
        <div class="carousel-item" data-bs-interval="4000">
            <img src="https://images.unsplash.com/photo-1550009158-9ebf69173e03?q=80&w=1200&h=400&fit=crop" class="d-block w-100" alt="Eletrônicos" style="object-fit: cover; height: 350px;">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                <h2 class="fw-bold">Tecnologia de Ponta</h2>
                <p class="fs-5">Os melhores gadgets você encontra aqui.</p>
            </div>
        </div>
        
        <div class="carousel-item" data-bs-interval="4000">
            <img src="https://images.unsplash.com/photo-1586880244406-556ebe35f282?q=80&w=1200&h=400&fit=crop" class="d-block w-100" alt="Entrega Rápida" style="object-fit: cover; height: 350px;">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
                <h2 class="fw-bold">Entrega Rápida</h2>
                <p class="fs-5">Frete grátis para todo o Brasil nas compras acima de R$ 200.</p>
            </div>
        </div>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Anterior</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Próximo</span>
    </button>
</div>


<h2 class="mb-4">Nossos Produtos</h2>

<div class="row">
    {% for produto in produtos %}
    <div class="col-sm-6 col-md-3 mb-4">
        <div class="card h-100 shadow-sm border-0">
            
            <div class="produto-img-container" style="height: 200px; padding: 0; border-bottom: 1px solid #f0f0f0;">
                
                {% if produto.outras_imagens.all %}
                    <div id="carousel-{{ produto.id }}" class="carousel slide h-100" data-bs-interval="false">
                        <div class="carousel-inner h-100">
                            <div class="carousel-item active h-100">
                                <a href="{% url 'detalhe_produto' produto.pk %}" class="d-flex align-items-center justify-content-center h-100 w-100">
                                    <img src="{{ produto.imagem.url }}" class="d-block" style="max-height: 100%; max-width: 100%; object-fit: contain;">
                                </a>
                            </div>
                            {% for foto_extra in produto.outras_imagens.all %}
                            <div class="carousel-item h-100">
                                <a href="{% url 'detalhe_produto' produto.pk %}" class="d-flex align-items-center justify-content-center h-100 w-100">
                                    <img src="{{ foto_extra.imagem.url }}" class="d-block" style="max-height: 100%; max-width: 100%; object-fit: contain;">
                                </a>
                            </div>
                            {% endfor %}
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#carousel-{{ produto.id }}" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon bg-dark rounded-circle" aria-hidden="true" style="background-size: 50%;"></span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#carousel-{{ produto.id }}" data-bs-slide="next">
                            <span class="carousel-control-next-icon bg-dark rounded-circle" aria-hidden="true" style="background-size: 50%;"></span>
                        </button>
                    </div>

                {% else %}
                    <div style="height: 100%; background: white;">
                        <a href="{% url 'detalhe_produto' produto.pk %}" style="height: 100%; display: flex; align-items: center; justify-content: center; padding: 10px;">
                            {% if produto.imagem %}
                                <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }}" style="max-height: 100%; max-width: 100%; object-fit: contain;">
                            {% else %}
                                <span class="text-muted small">Sem Foto</span>
                            {% endif %}
                        </a>
                    </div>
                {% endif %}

            </div>
    
            <div class="card-body d-flex flex-column">
                <h5 class="card-title text-dark fw-bold" style="font-size: 1.1rem;">
                    <a href="{% url 'detalhe_produto' produto.pk %}" class="text-decoration-none text-dark">
                        {{ produto.nome|truncatechars:35 }}
                    </a>
                </h5>
                <p class="card-text text-muted small">
                    {{ produto.descricao|truncatechars:60 }}
                </p>
                <div class="mt-auto pt-3">
                    <h4 class="text-primary mb-2">R$ {{ produto.preco }}</h4>
                    <div class="d-grid gap-2">
                        <a href="{% url 'detalhe_produto' produto.pk %}" class="btn btn-outline-primary btn-sm">Ver Detalhes</a>
                        <a href="{% url 'add_carrinho' produto.pk %}" class="btn btn-success btn-sm">Comprar</a>
                    </div>
                </div>
            </div>

        </div>
    </div>
    {% endfor %}
</div>

{% endblock %}